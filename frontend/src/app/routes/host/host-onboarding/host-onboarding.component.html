<h1>Host Onboarding</h1>
<ui-hr></ui-hr>

<mat-spinner *ngIf="onboarding.loading"></mat-spinner>
<ng-container *ngIf="onboarding.data">
  <!-- Form has been submitted for verification -->
  <div class="flex flex-col h-full" *ngIf="currentState == states.PendingVerification">
    <ng-container
      [ngTemplateOutlet]="review">
    </ng-container>
  </div>

  <!-- Form requires changing -->
  <div class="flex h-full" *ngIf="currentState == states.AwaitingChanges || currentState == states.HasIssues">
    <div class="flex-initial rounded shadow overflow-hidden mr-6">
      <mat-vertical-stepper #stepper *ngIf="onboarding.data" class="h-full" (selectionChange)="handleSelectionChange($event)">
        <mat-step *ngFor="let step of stepUiMap | keyvalue" [label]="step.value['label']">
          <br />
        </mat-step>

        <mat-step label="Review & Submit"></mat-step>
      </mat-vertical-stepper>
    </div>

    <div class="flex-grow md:max-w-2xl">
      <ng-container *ngIf="!onReviewStep">
        <mat-spinner *ngIf="componentRefreshing"></mat-spinner>
        <ng-container *ngIf="!componentRefreshing">
          <ui-form
            (onSuccess)="handleStepSuccess(selectedStep)"
            (onFailure)="handleStepFailure(selectedStep)"
            [form]="stepUiMap[selectedStep].form"
            [cacheable]="stepData[selectedStep]">
          </ui-form>
        </ng-container>
      </ng-container>

      <ng-container *ngIf="onReviewStep" [ngTemplateOutlet]="review"></ng-container>
    </div>
  </div>
</ng-container>


<!-- Re-useable template for review & pending verification -->
<ng-template #review>
  <ng-container *ngIf="currentState == states.PendingVerification">
    <h2>Under review</h2>
    <p>
      Our team is currently in the process of reviewing your information, once complete we will notify you via e-mail for changes.
      <br/>
      This process typically takes around a day.
    </p>

    <ui-hr></ui-hr>
  </ng-container>

  <ng-container *ngIf="currentState == states.AwaitingChanges || currentState == states.HasIssues">
    <h2>Review & submit for verification</h2>
    <p>Please ensure all steps are valid to the best of your knowledge before submitting.</p>
  </ng-container>

  <ui-placeholder><h3>Review step map from VN-135</h3></ui-placeholder>

  <div class="mt-5" *ngIf="currentState == states.AwaitingChanges || currentState == states.HasIssues">
    <ui-button
      kind="primary" size="l"
      (click)="submitForVerification()"
      [loading]="onboarding.loading">
        Submit for Verification
    </ui-button>
  </div>
</ng-template>
